<!-- templates/index.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <script src="https://code.jquery.com/jquery-2.1.4.js" type="text/javascript"></script>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="lib/axios/dist/axios.standalone.js" type="text/javascript"></script>
    <script src="lib/CryptoJS/rollups/hmac-sha256.js" type="text/javascript"></script>
    <script src="lib/CryptoJS/rollups/sha256.js" type="text/javascript"></script>
    <script src="lib/CryptoJS/components/hmac.js" type="text/javascript"></script>
    <script src="lib/CryptoJS/components/enc-base64.js" type="text/javascript"></script>
    <script src="lib/url-template/url-template.js" type="text/javascript"></script>
    <script src="lib/apiGatewayCore/sigV4Client.js" type="text/javascript"></script>
    <script src="lib/apiGatewayCore/apiGatewayClient.js" type="text/javascript"></script>
    <script src="lib/apiGatewayCore/simpleHttpClient.js" type="text/javascript"></script>
    <script src="lib/apiGatewayCore/utils.js" type="text/javascript"></script>
    <script src="apigClient.js" type="text/javascript"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.283.1.min.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="static/css/style.css" rel="stylesheet">
    <script>
        function my_submit() {
            var apigClient = apigClientFactory.newClient();
            var params = {
                //This is where any header, path, or querystring request params go. The key is the parameter named as defined in the API
            };
            // const queryString = window.location.search;
            // console.log(queryString);
            // const urlParams = new URLSearchParams(queryString);
            transaction = document.getElementById("transaction").value;
            console.log(transaction);
            var body = {
                //This is where you define the body of the request
                'transaction': transaction
            };
            var additionalParams = {}
            if (transaction == ""){
                alert("You need to enter a piece of transaction information");
            } else {
                apigClient.requestPost(params, body, additionalParams)
                    .then(function (result) {
                        // console.log(result.data)
                        // var json = JSON.parse(result.data.body)
                        // console.log(json.message)
                        // //alert(json.message);
                        // document.getElementById("response").innerHTML = json.message;
                        // if (json.access){
                        //     document.getElementById("access").innerHTML = '<img class="small_img" src="static/images/yes.png" alt="Access Approved"><br>';
                        // } else {
                        //     document.getElementById("access").innerHTML = '<img class="small_img" src="static/images/no.png" alt="Access Denied"><br>';
                        // }
                        document.getElementById("response").innerHTML = "Your transaction is received. If there is further issue, we will remind you";
                        // document.getElementById("access").innerHTML = '<img class="small_img" src="static/images/yes.png" alt="Access Approved"><br>';
                        document.getElementById("check_result").innerHTML = "";
                        document.getElementById("result_image").innerHTML = '<img class="small_img" src="static/images/pending.gif" alt="Pending"><br>';

                        PeriodCheck = setInterval(check_result2, 1000);
                        
                    }).catch(function (result) {
                    //This is where you would put an error callback
                    console.log(result);
                });                
            }
        };
        function check_result2() {
            
            var apigClient = apigClientFactory.newClient();
            var params = {
                //This is where any header, path, or querystring request params go. The key is the parameter named as defined in the API
            };
            var body = {
                //This is where you define the body of the request
                // 'transaction': transaction
            };
            transaction = document.getElementById("transaction").value;
            trans_arr = transaction.split("|");
            user_id = trans_arr[0];
            transaction_id = trans_arr[1];
            var additionalParams = {
                queryParams: {
                    "user_id": user_id,
                    "transaction_id": transaction_id
                }
                
            };

            if (user_id == ""){
                alert("You need to enter user id in order to check the result!");
                return;
            }
            if (transaction_id == ""){
                alert("You need to enter transaction id in order to check the result!");
                return;
            }

            apigClient.requestGet(params, body, additionalParams)
                    .then(function (result) {
                        console.log(result);
                        // var json = JSON.parse(result.data.body)
                        // console.log(json)
                        var status = result.status
                        document.getElementById("check_result").innerHTML = result.data;
                        if (status === 200){
                            document.getElementById("result_image").innerHTML = '<img class="small_img" src="static/images/yes.png" alt="Approved"><br>';
                            clearInterval(PeriodCheck);
                        } else if (status === 208) {
                            document.getElementById("result_image").innerHTML = '<img class="small_img" src="static/images/pending.gif" alt="Pending"><br>';
                        }
                        // console.log(json.message)
                        // //alert(json.message);
                        // document.getElementById("response").innerHTML = json.message;
                        // if (json.access){
                        //     document.getElementById("access").innerHTML = '<img class="small_img" src="static/images/yes.png" alt="Access Approved"><br>';
                        // } else {
                        //     document.getElementById("access").innerHTML = '<img class="small_img" src="static/images/no.png" alt="Access Denied"><br>';
                        // }
                        // document.getElementById("response").innerHTML = "Your transaction is received. If there is further issue, we will remind you";
                        // document.getElementById("access").innerHTML = '<img class="small_img" src="static/images/yes.png" alt="Access Approved"><br>';
                        
                    }).catch(function (result) {
                    //This is where you would put an error callback
                    console.log(result);
                    document.getElementById("result_image").innerHTML = '<img class="small_img" src="static/images/no.png" alt="Access Denied"><br>';
                    document.getElementById("check_result").innerHTML = result.data;
                    clearInterval(PeriodCheck);
                });  

        };

        function check_result() {
            clearInterval(PeriodCheck);
            var apigClient = apigClientFactory.newClient();
            var params = {
                //This is where any header, path, or querystring request params go. The key is the parameter named as defined in the API
            };
            var body = {
                //This is where you define the body of the request
                'transaction': transaction
            };

            user_id = document.getElementById("user_id").value;
            transaction_id = document.getElementById("transaction_id").value;
            var additionalParams = {
                queryParams: {
                    "user_id": user_id,
                    "transaction_id": transaction_id
                }
                
            };

            if (user_id == ""){
                alert("You need to enter user id in order to check the result!");
                return;
            }
            if (transaction_id == ""){
                alert("You need to enter transaction id in order to check the result!");
                return;
            }

            apigClient.requestGet(params, body, additionalParams)
                    .then(function (result) {
                        console.log(result);
                        // var json = JSON.parse(result.data.body)
                        // console.log(json)
                        var status = result.status
                        document.getElementById("check_result").innerHTML = result.data;
                        if (status === 200){
                            document.getElementById("result_image").innerHTML = '<img class="small_img" src="static/images/yes.png" alt="Approved"><br>';
                        } else {
                            document.getElementById("result_image").innerHTML = '<img class="small_img" src="static/images/no.png" alt="Access Denied"><br>';
                        }
                        // console.log(json.message)
                        // //alert(json.message);
                        // document.getElementById("response").innerHTML = json.message;
                        // if (json.access){
                        //     document.getElementById("access").innerHTML = '<img class="small_img" src="static/images/yes.png" alt="Access Approved"><br>';
                        // } else {
                        //     document.getElementById("access").innerHTML = '<img class="small_img" src="static/images/no.png" alt="Access Denied"><br>';
                        // }
                        // document.getElementById("response").innerHTML = "Your transaction is received. If there is further issue, we will remind you";
                        // document.getElementById("access").innerHTML = '<img class="small_img" src="static/images/yes.png" alt="Access Approved"><br>';
                        
                    }).catch(function (result) {
                    //This is where you would put an error callback
                    console.log(result);
                    document.getElementById("result_image").innerHTML = '<img class="small_img" src="static/images/no.png" alt="Access Denied"><br>';
                    document.getElementById("check_result").innerHTML = result.data;
                });  

        };
    </script>
</head>
<body>
    <div class='div-center'>
        <h2 align="center">Transaction</h2>
        
        <img src="static/images/atm.jpg" alt="Input Your Transaction Information"><br>
        Input Your Transaction Information:<br>
        <input id="transaction" type="text">
        <br><br>
        <button id="user-input-button" onclick="my_submit()">SUBMIT</button>
        <p id="response"></p>
        
        <h4 align="center">Sample Genuine Transactions:</h4>
        <h5 align="center" id="genuine">045-74-5650|3573869538621003|Vickie|Walker|F|161 Moyer Locks|Mont Alto|PA|17237|39.8417|-77.5537|1917|Press sub|1948-10-25|355104838454|adults_50up_female_rural.json|e8432e6b0f236e1a778238f78a29a28e|2013-05-26|19:58:38|1369598318|entertainment|73.07|0|fraud_Turcotte, McKenzie and Koss|40.389649|-77.677457</h5>
        <!-- <button id="user-input-button-2">SUBMIT</button> -->

        <br></br>

        <h4 align="center">Sample Fraud Transactions:</h4>
        <h5 align="center" id="fraud">045-74-5650|3573869538621003|Vickie|Walker|F|161 Moyer Locks|Mont Alto|PA|17237|39.8417|-77.5537|1917|Press sub|1948-10-25|355104838454|adults_50up_female_rural.json|857d4af9c18e39c7b0961db6f58cfb07|2013-09-20|22:08:45|1379714925|misc_pos|50.80|1|fraud_Reynolds-Schinner|40.754953|-77.233002</h5>

        <!-- <button id="user-input-button-3">SUBMIT</button> -->
        <br></br>

        <h4 align="center">Your Transanction Status</h4>
        <!-- User ID: <input id="user_id" type="text">
        <br></br>
        Transaction ID: <input id="transaction_id" type="text">
        <br><br>
        <button id="user-verify-button" onclick="check_result()">Check</button> -->
        <p id="check_result"></p>
        <div id="result_image">
        </div>
        <button id="user-verify-button" onclick="check_result2()">Recheck</button>
    </div>
    
</body>

</html>